<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover"/>
  <title>ðŸ’ª Exercise Timer</title>
  <style>
    html, body { height: 100%; overflow: hidden; } /* no scrollbars */
    :root { --pad: clamp(12px, 1.5vw, 20px); }
    details > summary { cursor: pointer; }
    button:focus-visible { outline: 3px solid rgba(16,185,129,.6); outline-offset: 2px; }
  </style>
  <script src="https://cdn.tailwindcss.com"></script>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>
<body class="bg-slate-900 text-white">
  <div id="root" class="h-full"></div>

  <script type="text/babel">
    const { useEffect, useRef, useState } = React;

    /* ===== Version & Storage ===== */
    const APP_VERSION = "v4";
    const SETTINGS_KEY = "exerciseTimerSettings:v15";

    /* ===== Defaults ===== */
    const DEFAULTS = {
      totalSets: 12,
      workMin: 3, workSec: 0,
      restSec: 60,
      warmupSec: 30,
      enableWarmup: true,
      warningSec: 10,
      enableWarning: true,
      finishChime: true, // auto at end
      soundOn: true,
      volume: 75,
      theme: "emerald-sky-amber",
      customColors: {
        WARMUP: { start:"#fcd34d", end:"#f59e0b" },
        WORK:   { start:"#34d399", end:"#059669" },
        REST:   { start:"#38bdf8", end:"#0284c7" },
        DONE:   { start:"#d4d4d8", end:"#71717a" }
      }
    };

    /* ===== Color Palettes ===== */
    const PALETTES = {
      "emerald-sky-amber": {
        label: "Default (Emerald / Sky / Amber)",
        WARMUP: { start:"#fcd34d", end:"#f59e0b" },
        WORK:   { start:"#34d399", end:"#059669" },
        REST:   { start:"#38bdf8", end:"#0284c7" },
        DONE:   { start:"#d4d4d8", end:"#71717a" }
      },
      "red-indigo-orange": {
        label: "Red / Indigo / Orange",
        WARMUP: { start:"#fb923c", end:"#f97316" },
        WORK:   { start:"#f87171", end:"#dc2626" },
        REST:   { start:"#818cf8", end:"#4f46e5" },
        DONE:   { start:"#d4d4d8", end:"#71717a" }
      },
      "purple-teal-rose": {
        label: "Purple / Teal / Rose",
        WARMUP: { start:"#fda4af", end:"#fb7185" },
        WORK:   { start:"#c084fc", end:"#7c3aed" },
        REST:   { start:"#5eead4", end:"#0d9488" },
        DONE:   { start:"#d4d4d8", end:"#71717a" }
      },
      "slate-blue-green": {
        label: "Slate / Blue / Green",
        WARMUP: { start:"#93c5fd", end:"#3b82f6" },
        WORK:   { start:"#86efac", end:"#16a34a" },
        REST:   { start:"#94a3b8", end:"#475569" },
        DONE:   { start:"#d4d4d8", end:"#71717a" }
      },
      "custom": { label: "Custom (pick your own)" }
    };

    /* ===== Load/Save ===== */
    const loadSettings = () => {
      try {
        const s = JSON.parse(localStorage.getItem(SETTINGS_KEY) || "{}");
        return { ...DEFAULTS, ...s, customColors: { ...DEFAULTS.customColors, ...(s.customColors||{}) } };
      } catch { return DEFAULTS; }
    };
    const saveSettings = (obj) => localStorage.setItem(SETTINGS_KEY, JSON.stringify(obj));

    /* ===== Wake Lock (web/PWA) ===== */
    let screenLock = null;
    async function webWakeStart() {
      try { if ('wakeLock' in navigator && navigator.wakeLock.request) screenLock = await navigator.wakeLock.request('screen'); } catch {}
    }
    async function webWakeStop() {
      try { await screenLock?.release(); } catch {}
      screenLock = null;
    }
    document.addEventListener('visibilitychange', async () => {
      if (document.visibilityState === 'visible' && window.__timerRunning) await webWakeStart();
    });

    function App(){
      const initial = loadSettings();

      /* View mode */
      const [mode, setMode] = useState("SETUP"); // SETUP | RUN

      /* Knobs */
      const [totalSets, setTotalSets] = useState(initial.totalSets);
      const [workMin, setWorkMin] = useState(initial.workMin);
      const [workSec, setWorkSec] = useState(initial.workSec);
      const [restSec, setRestSec] = useState(initial.restSec);
      const [warmupSec, setWarmupSec] = useState(initial.warmupSec);
      const [enableWarmup, setEnableWarmup] = useState(initial.enableWarmup);
      const [warningSec, setWarningSec] = useState(initial.warningSec);
      const [enableWarning, setEnableWarning] = useState(initial.enableWarning);

      /* Sound + prefs */
      const [soundOn, setSoundOn] = useState(initial.soundOn);
      const [volume, setVolume] = useState(initial.volume);
      const [theme, setTheme] = useState(initial.theme);
      const [customColors, setCustomColors] = useState(initial.customColors);

      /* Runtime */
      const [isRunning, setIsRunning] = useState(false);
      const [phase, setPhase] = useState(enableWarmup ? "WARMUP" : "WORK"); // WARMUP | WORK | REST | DONE
      const [setNum, setSetNum] = useState(enableWarmup ? 0 : 1);
      const [remaining, setRemaining] = useState(enableWarmup ? warmupSec : (workMin*60 + workSec));

      const workTotal = workMin*60 + workSec;
      const restTotal = restSec;

      /* Persist settings */
      useEffect(() => {
        saveSettings({
          totalSets, workMin, workSec, restSec,
          warmupSec, enableWarmup,
          warningSec, enableWarning,
          soundOn, volume, theme, customColors
        });
      }, [totalSets, workMin, workSec, restSec, warmupSec, enableWarmup, warningSec, enableWarning, soundOn, volume, theme, customColors]);

      /* Sync remaining when paused or in SETUP */
      useEffect(() => {
        if (!isRunning || mode === "SETUP") {
          if (phase === "WARMUP") setRemaining(enableWarmup ? warmupSec : workTotal);
          else if (phase === "WORK") setRemaining(workTotal);
          else if (phase === "REST") setRemaining(restTotal);
        }
      }, [workMin, workSec, restSec, warmupSec, enableWarmup, mode, phase]);

      /* ===== Audio ===== */
      const audioCtxRef = useRef(null);
      const masterGainRef = useRef(null);
      const ensureAudio = () => {
        if (!audioCtxRef.current) {
          const Ctx = window.AudioContext || window.webkitAudioContext;
          if (!Ctx) return;
          audioCtxRef.current = new Ctx();
        }
        if (!masterGainRef.current) {
          const ctx = audioCtxRef.current;
          const g = ctx.createGain();
          g.gain.value = (soundOn ? volume : 0) / 100;
          g.connect(ctx.destination);
          masterGainRef.current = g;
        }
      };
      useEffect(() => {
        if (masterGainRef.current) masterGainRef.current.gain.value = (soundOn ? volume : 0) / 100;
      }, [soundOn, volume]);

      const playBeep = (freq=880, duration=0.12) => {
        ensureAudio();
        const ctx = audioCtxRef.current, master = masterGainRef.current;
        if (!ctx || !master || master.gain.value <= 0) return;
        const o = ctx.createOscillator(); const g = ctx.createGain();
        o.type='sine'; o.frequency.value=freq; o.connect(g); g.connect(master);
        const now=ctx.currentTime;
        g.gain.setValueAtTime(0.0001, now);
        g.gain.exponentialRampToValueAtTime(0.6, now+0.01);
        g.gain.exponentialRampToValueAtTime(0.0001, now+duration);
        o.start(now); o.stop(now+duration+0.02);
      };

      const playBell = () => {
        ensureAudio();
        const ctx = audioCtxRef.current, master = masterGainRef.current;
        if (!ctx || !master || master.gain.value <= 0) return;
        const hit=(f,t,gain=0.7)=>{
          const o=ctx.createOscillator(), g=ctx.createGain();
          o.type='triangle'; o.frequency.setValueAtTime(f,t);
          o.connect(g); g.connect(master);
          g.gain.setValueAtTime(0.0001,t);
          g.gain.exponentialRampToValueAtTime(gain,t+0.005);
          g.gain.exponentialRampToValueAtTime(0.0001,t+1.0);
          o.start(t); o.stop(t+1.1);
        };
        const t=ctx.currentTime; hit(660,t,0.6); hit(440,t+0.02,0.55); hit(880,t+0.04,0.45);
      };

      const playFinishChime = () => {
        ensureAudio();
        const ctx = audioCtxRef.current, master = masterGainRef.current;
        if (!ctx || !master || master.gain.value <= 0) return;
        const add=(type,freq,start,len,peak=0.7)=>{
          const o=ctx.createOscillator(), g=ctx.createGain();
          o.type=type; o.frequency.setValueAtTime(freq,start);
          o.connect(g); g.connect(master);
          g.gain.setValueAtTime(0.0001,start);
          g.gain.exponentialRampToValueAtTime(peak,start+0.03);
          g.gain.exponentialRampToValueAtTime(0.0001,start+len);
          o.start(start); o.stop(start+len+0.05);
        };
        const t = ctx.currentTime;
        add('triangle', 784,  t,      1.2, 0.70);
        add('sine',     1047, t+0.02, 0.9, 0.45);
        add('triangle', 659,  t+0.04, 1.0, 0.55);
        add('sine',     523,  t+0.50, 0.8, 0.25);
      };

      /* ===== Timer loop ===== */
      useEffect(() => {
        if (mode !== "RUN" || !isRunning || phase === 'DONE') return;
        const id = setInterval(() => setRemaining(s => Math.max(0, s - 1)), 1000);
        return () => clearInterval(id);
      }, [mode, isRunning, phase]);

      /* ===== Transitions + warning + finish ===== */
      useEffect(() => {
        if (mode !== "RUN" || phase === 'DONE') return;

        if (remaining === 0) {
          playBell();
          if (phase === 'WARMUP') {
            setPhase('WORK'); setSetNum(1); setRemaining(workTotal);
          } else if (phase === 'WORK') {
            if (setNum >= totalSets) {
              setPhase('DONE'); setIsRunning(false);
              setTimeout(() => playFinishChime(), 50);
            } else {
              setPhase('REST'); setRemaining(restTotal);
            }
          } else if (phase === 'REST') {
            setPhase('WORK'); setSetNum(n => n + 1); setRemaining(workTotal);
          }
        } else if (enableWarning && (phase === 'WORK' || phase === 'WARMUP') && remaining === warningSec) {
          playBeep(880,0.08); setTimeout(()=>playBeep(880,0.08),160); setTimeout(()=>playBeep(880,0.08),320);
        }
      }, [mode, remaining, enableWarning, setNum, totalSets, phase, warningSec, workTotal, restTotal]);

      /* ===== Keyboard shortcuts ===== */
      useEffect(() => {
        const onKey = (e) => {
          const k = e.key.toLowerCase();
          if (mode === "SETUP") {
            if (e.code === 'Space') { e.preventDefault(); startSession(); }
          } else if (mode === "RUN") {
            if (phase === 'DONE') {
              if (e.code === 'Space') { e.preventDefault(); doResetToSetup(); } // no chime here
            } else {
              if (e.code === 'Space') { e.preventDefault(); toggleRun(); }
              else if (e.code === 'Enter') { e.preventDefault(); doResetToSetup(); }
              else if (k === 'n') { e.preventDefault(); setRemaining(0); } // next
            }
          }
        };
        window.addEventListener('keydown', onKey);
        return () => window.removeEventListener('keydown', onKey);
      }, [mode, isRunning, phase]);

      /* ===== Title ===== */
      useEffect(() => {
        if (mode === "SETUP") { document.title = "Exercise Timer â€¢ Setup"; return; }
        if (phase === "DONE") { document.title = "Finished â€¢ Exercise Timer"; return; }
        const t = formatClock(remaining);
        const p = phase === 'WORK' ? `S${setNum}` : phase;
        document.title = `${t} â€¢ ${p} â€¢ Exercise Timer`;
      }, [mode, remaining, phase, setNum]);

      const totalPhase = phase==='WORK'?workTotal: phase==='REST'?restTotal: phase==='WARMUP'?warmupSec:1;
      const progress = (1 - remaining/totalPhase) * 100;

      /* ===== Summary helpers ===== */
      const secsWorkTotal  = totalSets * workTotal;
      const secsRestTotal  = Math.max(0, totalSets - 1) * restSec; // rests between sets only
      const secsCombined   = secsWorkTotal + secsRestTotal;
      const fmtHMS = (s) => {
        const h = Math.floor(s/3600);
        const m = Math.floor((s%3600)/60);
        const ss = s%60;
        const mm = String(m).padStart(2,'0');
        const sss = String(ss).padStart(2,'0');
        return h>0 ? `${h}:${mm}:${sss}` : `${m}:${sss.padStart(2,'0')}`;
      };

      /* ===== Actions ===== */
      async function startSession(){
        setPhase(enableWarmup ? "WARMUP" : "WORK");
        setSetNum(enableWarmup ? 0 : 1);
        setRemaining(enableWarmup ? warmupSec : workTotal);
        setMode("RUN");
        setIsRunning(true);
        window.__timerRunning = true;
        if (window.desktopWakeLock?.start) { try { await window.desktopWakeLock.start(); } catch {} }
        await webWakeStart();
        ensureAudio();
      }
      async function toggleRun(){
        if (phase === 'DONE') return;
        const next = !isRunning;
        setIsRunning(next);
        if (next) { window.__timerRunning = true; if (window.desktopWakeLock?.start) try{await window.desktopWakeLock.start();}catch{}; await webWakeStart(); }
        else { window.__timerRunning = false; if (window.desktopWakeLock?.stop) try{await window.desktopWakeLock.stop();}catch{}; await webWakeStop(); }
        ensureAudio();
      }
      async function doResetToSetup(){
        setIsRunning(false);
        setMode("SETUP");
        window.__timerRunning = false;
        if (window.desktopWakeLock?.stop) try{await window.desktopWakeLock.stop();}catch{}
        await webWakeStop();
      }
      function formatClock(s){ const m=String(Math.floor(s/60)).padStart(2,'0'); const ss=String(Math.floor(s%60)).padStart(2,'0'); return `${m}:${ss}`; }

      /* ===== Colors ===== */
      const getPhaseColors = (p) => {
        if (theme === "custom") return customColors[p];
        const pal = PALETTES[theme] || PALETTES["emerald-sky-amber"];
        return pal[p] || PALETTES["emerald-sky-amber"][p];
      };
      const phaseStyle = (p) => {
        const {start, end} = getPhaseColors(p);
        return { backgroundImage: `linear-gradient(135deg, ${start}, ${end})` };
      };

      /* ===== UI atoms ===== */
      const Field = ({label, children}) => (
        <label className="bg-slate-900/60 border border-slate-700/60 rounded-2xl p-4 flex flex-col gap-2">
          <span className="text-sm text-slate-200/90">{label}</span>{children}
        </label>
      );
      const NumberInput = ({value,onChange,min=0,max=999,width="w-[84px]"}) => (
        <input type="number" value={value} min={min} max={max}
          onChange={e=>onChange(Math.max(min,Math.min(max,Number(e.target.value))))}
          className={`${width} rounded-xl px-3 py-2 bg-slate-800 border border-slate-600 focus:outline-none focus:ring-2 focus:ring-emerald-400/60`}/>
      );
      const Toggle = ({on, setOn, onLabel="Enabled", offLabel="Disabled"}) => (
        <button onClick={()=>setOn(v=>!v)}
          className={`px-3 py-2 rounded-xl border ${on?"bg-emerald-500/20 border-emerald-300":"bg-slate-800 border-slate-600"}`}>
          {on ? onLabel : offLabel}
        </button>
      );

      const ColorRow = ({phaseKey, label}) => (
        <div className="flex items-center gap-3">
          <div className="w-20 text-xs opacity-80">{label}</div>
          <div className="flex items-center gap-2">
            <span className="text-xs opacity-80">Start</span>
            <input type="color"
                   value={customColors[phaseKey].start}
                   onChange={e=>setCustomColors(c => ({...c, [phaseKey]:{...c[phaseKey], start:e.target.value}}))}/>
          </div>
          <div className="flex items-center gap-2">
            <span className="text-xs opacity-80">End</span>
            <input type="color"
                   value={customColors[phaseKey].end}
                   onChange={e=>setCustomColors(c => ({...c, [phaseKey]:{...c[phaseKey], end:e.target.value}}))}/>
          </div>
          <div className="flex-1 h-5 rounded border border-white/20"
               style={{backgroundImage:`linear-gradient(90deg, ${customColors[phaseKey].start}, ${customColors[phaseKey].end})`}}/>
        </div>
      );

      function applyDefaults(){
        setTotalSets(DEFAULTS.totalSets);
        setWorkMin(DEFAULTS.workMin);
        setWorkSec(DEFAULTS.workSec);
        setRestSec(DEFAULTS.restSec);
        setWarmupSec(DEFAULTS.warmupSec);
        setEnableWarmup(DEFAULTS.enableWarmup);
        setWarningSec(DEFAULTS.warningSec);
        setEnableWarning(DEFAULTS.enableWarning);
      }

      /* ===== Subviews ===== */
      const PhaseBanner = () => (
        <div className="flex items-center justify-center h-full">
          <div className="text-center">
            <div className="text-[clamp(28px,8vw,56px)] font-extrabold tracking-wide drop-shadow">
              {phase==='WARMUP' ? 'Warm-up'
               : phase==='WORK' ? `Set ${setNum} / ${totalSets}`
               : phase==='REST' ? 'Rest'
               : 'Finished'}
            </div>
          </div>
        </div>
      );

      const ClockCenter = () => (
        <div className="grid place-items-center h-full">
          <div className="text-center">
            <div className="font-black tabular-nums text-[clamp(56px,12vw,160px)] leading-none">
              {phase==='DONE' ? '00:00' : formatClock(remaining)}
            </div>
          </div>
        </div>
      );

      const FinishedView = () => (
        <div className="h-full rounded-3xl shadow-xl p-4 md:p-6 relative overflow-hidden flex flex-col" style={phaseStyle('DONE')}>
          <div className="flex-1 min-h-0">
            <button
              onClick={doResetToSetup}
              className="w-full h-full rounded-3xl bg-black/25 hover:bg-black/35 active:bg-black/40 border border-white/40 backdrop-blur
                         flex items-center justify-center text-[clamp(28px,8vw,56px)] font-extrabold tracking-wide">
              Finished
            </button>
          </div>

          <div className="mt-4 bg-black/25 border border-white/30 rounded-2xl px-4 py-3 text-sm md:text-base">
            <div className="opacity-90 font-semibold">Summary</div>
            <div className="h-3"></div>
            <div className="space-y-1 text-left">
              <div><span className="opacity-70">Sets:</span> {totalSets} Ã— {workMin}:{String(workSec).padStart(2,'0')} = <b>{fmtHMS(secsWorkTotal)}</b></div>
              <div><span className="opacity-70">Rests (between sets):</span> {Math.max(0,totalSets-1)} Ã— {restSec}s = <b>{fmtHMS(secsRestTotal)}</b></div>
              <div><span className="opacity-70">Total (sets + rests):</span> <b>{fmtHMS(secsCombined)}</b></div>
            </div>
          </div>
        </div>
      );

      /* ===== Render ===== */
      return (
        <div className="h-full w-full">
          <div className="h-full w-full flex items-center justify-center p-[var(--pad)]">
            <div className="w-full max-w-5xl h-full flex flex-col gap-3">
              {/* Header */}
              <div className="flex items-center justify-between">
                <h1 className="text-[clamp(18px,2.5vw,28px)] font-bold">
                  ðŸ’ª Exercise Timer <span className="ml-2 text-xs font-normal opacity-70">{APP_VERSION}</span>
                </h1>
                {mode==="RUN" && phase!=="DONE" && (
                  <div className="text-sm opacity-80">
                    {phase==='WARMUP'?'Warm-up': phase==='WORK'?`Set ${setNum} / ${totalSets}`: 'Rest'}
                  </div>
                )}
              </div>

              {/* Main Card */}
              <div className="flex-1 min-h-0">
                {mode === "SETUP" ? (
                  /* -------- SETUP SCREEN -------- */
                  <div
                    className="h-full rounded-3xl shadow-xl p-4 md:p-6 relative overflow-hidden flex flex-col pb-[150px] md:pb-0"
                    style={phaseStyle("WORK")}
                  >
                    {/* Big Start button (fills space) */}
                    <div className="flex-1 min-h-0">
                      <button
                        onClick={startSession}
                        title="Start (Space)"
                        className="w-full h-full rounded-3xl bg-black/25 hover:bg-black/35 active:bg-black/40 border border-white/40 backdrop-blur
                                   flex items-center justify-center text-[clamp(28px,8vw,56px)] font-extrabold tracking-wide"
                      >
                        Start
                      </button>
                    </div>

                    {/* 2Ã—3 Tiles (without Color Theme) */}
                    <div className="mt-4 grid grid-cols-1 md:grid-cols-2 gap-3">
                      {/* 1: Sets + Rest */}
                      <Field label="Sets & Rest (sec)">
                        <div className="flex flex-nowrap items-center gap-4">
                          <div className="flex items-center gap-2">
                            <span className="text-sm">Sets</span>
                            <NumberInput value={totalSets} min={1} max={30} onChange={setTotalSets}/>
                          </div>
                          <div className="flex items-center gap-2">
                            <span className="text-sm">Rest</span>
                            <NumberInput value={restSec} min={0} max={600} onChange={setRestSec}/>
                          </div>
                        </div>
                      </Field>

                      {/* 2: Set Length */}
                      <Field label="Set Length (mm:ss)">
                        <div className="flex gap-2">
                          <NumberInput value={workMin} min={0} max={20} onChange={setWorkMin}/>
                          <span className="self-center">:</span>
                          <NumberInput value={workSec} min={0} max={59} onChange={setWorkSec}/>
                        </div>
                      </Field>

                      {/* 3: Warning */}
                      <Field label="Warning">
                        <div className="flex items-center gap-3">
                          <Toggle on={enableWarning} setOn={setEnableWarning} onLabel="Enabled" offLabel="Disabled" />
                          <div className="flex items-center gap-2">
                            <span className={`text-sm ${enableWarning?"opacity-100":"opacity-50"}`}>Seconds left:</span>
                            <NumberInput value={warningSec} min={0} max={59} onChange={setWarningSec}/>
                          </div>
                        </div>
                      </Field>

                      {/* 4: Warm-up */}
                      <Field label="Warm-up">
                        <div className="flex items-center gap-3">
                          <Toggle on={enableWarmup} setOn={setEnableWarmup} onLabel="Enabled" offLabel="Disabled" />
                          <div className="flex items-center gap-2">
                            <span className={`text-sm ${enableWarmup?"opacity-100":"opacity-50"}`}>Seconds:</span>
                            <NumberInput value={warmupSec} min={0} max={300} onChange={setWarmupSec}/>
                          </div>
                        </div>
                      </Field>

                      {/* 5: Defaults */}
                      <Field label="Defaults">
                        <button
                          onClick={applyDefaults}
                          className="w-full px-3 py-2 rounded-xl bg-slate-800 border border-slate-600 hover:bg-slate-700"
                        >
                          Restore Default Settings
                        </button>
                      </Field>
                    </div>

                    {/* PINNED: Color Theme (bottom-left) */}
                    <div
                      className="absolute left-4 right-4 md:right-auto bottom-4 md:bottom-6 z-10 md:w-[calc(50%-0.375rem)]"
                    >
                      {/* half width minus 6px gap on desktop */}
                      <Field label="Color Theme">
                        <div className="flex flex-col gap-2">
                          <select
                            value={theme}
                            onChange={e=>setTheme(e.target.value)}
                            className="w-full rounded-xl px-3 py-2 bg-slate-800 border border-slate-600 focus:outline-none focus:ring-2 focus:ring-emerald-400/60"
                          >
                            {Object.entries(PALETTES).map(([k,v]) => (
                              <option key={k} value={k}>{v.label}</option>
                            ))}
                          </select>

                          {theme === "custom" && (
                            <details className="bg-slate-800/60 rounded-xl border border-slate-600/60 px-3 py-2">
                              <summary className="text-sm opacity-90">Customize gradients</summary>
                              <div className="mt-2 space-y-2">
                                <div className="text-xs opacity-75">Pick start/end colors for each phase:</div>
                                <ColorRow phaseKey="WARMUP" label="Warm-up" />
                                <ColorRow phaseKey="WORK"   label="Work" />
                                <ColorRow phaseKey="REST"   label="Rest" />
                                <ColorRow phaseKey="DONE"   label="Done" />
                                <button
                                  className="mt-2 px-3 py-2 rounded-lg bg-slate-700 hover:bg-slate-600 border border-white/10"
                                  onClick={()=>setCustomColors(DEFAULTS.customColors)}
                                >
                                  Reset Custom Colors
                                </button>
                              </div>
                            </details>
                          )}
                        </div>
                      </Field>
                    </div>
                  </div>
                ) : (
                  /* -------- RUN SCREEN -------- */
                  <>
                    {phase !== 'DONE' ? (
                      <div className="h-full rounded-3xl shadow-xl p-4 md:p-6 relative overflow-hidden flex flex-col" style={phaseStyle(phase)}>
                        <div className="absolute inset-x-0 top-0 h-2 bg-white/20">
                          <div className="h-full bg-white/80 transition-all" style={{width: `${Math.min(100, Math.max(0, progress))}%`}}/>
                        </div>

                        {/* Top 25% â€” BIG phase banner */}
                        <div className="flex-[1] min-h-0">
                          <PhaseBanner />
                        </div>

                        {/* Middle 50% â€” BIG CLOCK centered */}
                        <div className="flex-[2] min-h-0">
                          <ClockCenter />
                        </div>

                        {/* Controls */}
                        <div className="mt-4 flex flex-wrap items-center justify-center gap-2">
                          <button onClick={toggleRun}
                                  className="px-4 py-2 rounded-2xl bg-black/30 backdrop-blur border border-white/30 hover:bg-black/40 font-semibold">
                            {isRunning?"Pause":"Resume"}
                          </button>

                          <div className="flex items-center gap-3 bg-black/20 border border-white/30 rounded-2xl px-3 py-2">
                            <button
                              onClick={()=>setSoundOn(s=>!s)}
                              className={`px-3 py-2 rounded-xl border ${soundOn?"bg-emerald-500/20 border-emerald-300":"bg-slate-800 border-slate-600"}`}>
                              {soundOn ? "Sound: On" : "Sound: Off"}
                            </button>
                            <input type="range" min="0" max="100" value={volume}
                                   onChange={(e)=>setVolume(Number(e.target.value))}
                                   className="w-[180px] md:w-[220px] accent-emerald-300"/>
                          </div>

                          <button onClick={doResetToSetup}
                                  className="px-3 py-2 rounded-2xl bg-black/20 border border-white/30 hover:bg-black/30">
                            Settings
                          </button>
                        </div>
                      </div>
                    ) : (
                      <FinishedView />
                    )}
                  </>
                )}
              </div>
            </div>
          </div>
        </div>
      );
    }

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App/>);
  </script>
</body>
</html>
